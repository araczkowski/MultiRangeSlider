!function(w,$){$.widget("ui.mrs",$.ui.slider,{_create:function(){this._super()},_mouseCapture:function(a){return $(a.target).is("a.ui-slider-handle")&&(this._lastChangedValue=$(a.target.parentNode).find(".ui-slider-handle").index(a.target)),this._super(a)}}),w.Mrs=function(elementId,userOptions){function _init(){if(_mergeOptions(),(_options.max-_options.min)%_options.step!==0)throw"Slider length should be multiple to step";_slider=$("#"+elementId),_initEvents(),_build(),_addScale()}function _addScale(){$("#"+elementId).parent().prepend('<div id="steps_'+elementId+'" class="steps"></div>');for(var a=$("#steps_"+elementId),b=(_options.max-_options.min)/_options.step,c=96/b,d=0;b>d;d++){var e=_options.min+d*_options.step;$("<div/>",{id:"step_"+elementId+"_"+(Number(d)+1),"class":"step",style:"width:"+c+"%","data-start":e,html:'<span class="tick">'+_options.stepLabelDispFormat(e)+'</span><div class="step_content"></div></div>'}).appendTo(a)}$("#"+elementId).width(b*c+"%")}function _initEvents(){_options.slide=function(a,b){function c(a){var b,c,d={};for(b=0,c=a.length;c>b;b++){if(d[a[b]])return!1;d[a[b]]=!0}return!0}function d(){if("function"==typeof _onHandleSlide){var a=_getPeriodKeyByIndex(h);if(-1!==a){var c=_isLeftHandle(h)?0:1;_onHandleSlide($(b.handle),_periods[a].toPublic(),c)}}return!0}var e=[];e.push(b.value);for(var f=0;f<_periods.length;f++){var g=_periods[f].getAbscissas();e.push(g[0],g[1])}if(!c(e))return!1;var h=_slider.find("."+SELECTORS.handle["class"]).index(b.handle);return _validHandle(h,b.value)?(_updateHandle(h,b.value),d()):_isLeftHandle(h)&&_isThereNextLeftHandle(h)&&_validHandle(h-1,b.value)?(_updateHandles([[h,b.value],[h-1,b.value]]),d()):_isRightHandle(h)&&_isThereNextRightHandle(h)&&_validHandle(h+1,b.value)?(_updateHandles([[h,b.value],[h+1,b.value]]),d()):!1},_slider.on("mouseenter","."+SELECTORS.handle["class"],function(){if("function"==typeof _onHandleMouseenter){var a=_slider.find("."+SELECTORS.handle["class"]).index($(this)),b=_getPeriodKeyByIndex(a);if(-1!==b){var c=_isLeftHandle(a)?0:1;_onHandleMouseenter($(this),_periods[b].toPublic(),c)}}})}function _mergeOptions(){var fn;if(_options.disabled="blocks"===_options.mode?!0:!1,!userOptions)return _options;"undefined"!=typeof userOptions.blocksToolbar&&"string"==typeof userOptions.blocksToolbar&&(userOptions.blocksToolbar=JSON.parse(userOptions.blocksToolbar)),"undefined"!=typeof userOptions.handleLabelDispFormat&&"string"==typeof userOptions.handleLabelDispFormat&&(eval("var fn = "+userOptions.handleLabelDispFormat),userOptions.handleLabelDispFormat=fn),"undefined"!=typeof userOptions.stepLabelDispFormat&&"string"==typeof userOptions.stepLabelDispFormat&&(eval("var fn = "+userOptions.stepLabelDispFormat),userOptions.stepLabelDispFormat=fn);for(var optionKey in _options)if(optionKey in userOptions)switch(typeof _options[optionKey]){case"boolean":_options[optionKey]=!!userOptions[optionKey];break;case"number":_options[optionKey]=Math.abs(userOptions[optionKey]);break;case"string":_options[optionKey]=""+userOptions[optionKey];break;default:_options[optionKey]=userOptions[optionKey]}return _options}function _toggleHandles(a){_slider.find("."+SELECTORS.handle["class"]).toggle(!!a)}function _isLeftHandle(a){return a%2===0}function _isRightHandle(a){return a%2!==0}function _isThereNextLeftHandle(a){var b=_slider.mrs("option","values");return a in b&&void 0!==b[a-1]?!0:!1}function _isThereNextRightHandle(a){var b=_slider.mrs("option","values");return a in b&&void 0!==b[a+1]?!0:!1}function _getPeriodKey(a){for(var b=0;b<_periods.length;b++)if(_periods[b]&&_periods[b].getId()===a)return b;return-1}function _getPeriodKeyByIndex(a){for(var b=0;b<_periods.length;b++)if(-1!==_periods[b].getIndexes().indexOf(a))return b;return-1}function _getPeriodKeyByInnerPoint(a){for(var b=0;b<_periods.length;b++){var c=_periods[b].getAbscissas();if(a>=c[0]&&a<=c[1])return b}return-1}function _rangeIntersectsPeriods(a,b){try{var c=a+b/2,d=_getSurroundingPoints(c);if(a<d[0]||a+b>d[1])return!0}catch(e){return!0}return!1}function _getSurroundingPoints(a){if(-1!==_getPeriodKeyByInnerPoint(a))throw"Passed abscissa is within the period";for(var b=_options.min,c=_options.max,d=0;d<_periods.length;d++){var e=_periods[d].getAbscissas();a>e[1]&&(b=e[1]),a<e[0]&&c===_options.max&&(c=e[0])}return[b,c]}function _isValidParams(a,b){return a<_options.min||a>=_options.max||b<_options.step?!1:!0}function _deletePeriod(a){var b=_getPeriodKey(a);if(-1!==b){var c=!!_periods.splice(b,1).length;return"function"==typeof _onDeletePeriod&&_onDeletePeriod(),c}return!1}function _sanitizeValue(a){return a=Math.round(Math.abs(a)),a-=a%_options.step}function _addPeriod(a,b){if(a=_sanitizeValue(a),b=_sanitizeValue(b),!_isValidParams(a,b))return null;var c=a+b/2;if(-1!==_getPeriodKeyByInnerPoint(c))return null;if(_rangeIntersectsPeriods(a,b)){var d=_getSurroundingPoints(c),e=d[1]-c>c-d[0]?c-d[0]:d[1]-c;return e-=_options.step,a=c-e,b=2*e,_addPeriod(a,b)}try{var f=new Period(a,a+b);return _periods.push(f),_periods.sort(function(a,b){return a.getAbscissas()[0]-b.getAbscissas()[0]}),"function"==typeof _onAddPeriod&&_onAddPeriod(),f}catch(g){return null}}function _validHandle(a,b){var c=_slider.mrs("option","values");return a in c?void 0!==c[a-1]&&(b<c[a-1]||_isRightHandle(a)&&b===c[a-1])?!1:void 0!==c[a+1]&&(b>c[a+1]||_isLeftHandle(a)&&b===c[a+1])?!1:!0:!1}function _updateHandle(a,b){_updateHandles([[a,b]])}function _updateHandles(a){for(var b in a){var c=a[b][0],d=a[b][1],e=_getPeriodKeyByIndex(c);if(-1!==e){var f=_periods[e].getIndexes(),g=_periods[e].getAbscissas();g[f.indexOf(c)]=d,_periods[e].setAbscissas(g)}}_build(!0)}function _drawRange(a,b){var c=$('<div class="'+SELECTORS.range["class"]+" "+SELECTORS.range["class"]+"-"+a+'"></div>');_slider.append(c),_alignRange(a,b)}function _alignRange(a,b){var c=_slider.find("."+SELECTORS.range["class"]+"-"+a);c.css({left:Utils.convertToPercent(b[0]-_options.min)+"%",width:Utils.convertToPercent(b[1]-b[0])+"%"})}function _destroy(){_slider.mrs("destroy"),_slider.find("."+SELECTORS.range["class"]).remove()}function _rebuild(){_destroy(),_build()}function _build(a){for(var b=[],c=0;c<_periods.length;c++){var d=_periods[c].getAbscissas(),e=b.push(d[0],d[1]);_periods[c].setIndexes([e-2,e-1]),a?_alignRange(_periods[c].getId(),d):_drawRange(_periods[c].getId(),d)}_options.values=b,_slider.mrs(_options),a?_alignControls():_rebuildControls(),_refreshHandles()}function _rebuildControls(){_slider.find("."+SELECTORS.control.claaddControlss+"-plus,."+SELECTORS.control["class"]+"-minus").remove();var a=function(a,b){var c,d=$('<div class="'+SELECTORS.control["class"]+"-"+a+" "+SELECTORS.control["class"]+"-"+b+'"></div>');d.hide(),d.on("mousedown",function(d){function e(){_deletePeriod(b)&&_rebuild()}if(d.stopPropagation(),"blocks"!==_options.mode)if("minus"===a)c=_getPeriodKey(b),-1!==c&&("function"==typeof _deletePeriodConfirm?_deletePeriodConfirm(_periods[c].toPublic(),function(a){a&&e()}):e());else if("plus"===a){var f,g=_options.newlength,h=_options.min,i=_options.max;if("base"===b)c=_getPeriodKeyByIndex(0),-1!==c&&(i=_periods[c].getAbscissas()[0]);else if(c=_getPeriodKey(b),-1!==c){var j=_periods[c].getIndexes(),k=_getPeriodKeyByIndex(j[1]+1);h=_periods[c].getAbscissas()[1],-1!==k&&(i=_periods[k].getAbscissas()[0])}g>i-h&&(g=i-h),f=h+(i-h)/2-g/2;var l=_addPeriod(f,g);null!==l&&("function"==typeof _addPeriodConfirm?_addPeriodConfirm(l.toPublic(),function(a){a||_deletePeriod(l.getId()),_rebuild()}):_rebuild())}}),_slider.append(d)};a("plus","base");var b=_periods.length;if(b>0)for(var c=0;b>c;c++)a("minus",_periods[c].getId()),a("plus",_periods[c].getId());_alignControls()}function _alignControls(){_slider.find("."+SELECTORS.control["class"]+"-plus,."+SELECTORS.control["class"]+"-minus").hide();var a=function(a,b,c){var d=_slider.find("."+SELECTORS.control["class"]+"-"+a+"."+SELECTORS.control["class"]+"-"+b);d.css({left:Utils.convertToPercent(c)+"%"}),d.show()},b=_options.min,c="base",d=_periods.length;if(d>0){for(var e=0;d>e;e++){var f=_periods[e].getAbscissas(),g=_periods[e].getId();f[0]-b>=_options.gap&&a("plus",c,b-_options.min+(f[0]-b)/2),a("minus",g,f[0]-_options.min+(f[1]-f[0])/2),b=f[1],c=g}_options.max-b>=_options.gap&&a("plus",c,b-_options.min+(_options.max-b)/2)}else a("plus","base",(_options.max-_options.min)/2)}function _refreshHandles(){var a=_slider.find("."+SELECTORS.handle["class"]),b=_slider.mrs("option","values"),c=-1;a.removeClass("arrow-left arrow-right");for(var d in b)a.eq(d).html('<span class="handle_label">'+_options.handleLabelDispFormat(b[d])+"</span>"),b[d]===c&&(a.eq(d-1).addClass("arrow-left"),a.eq(d).addClass("arrow-right")),c=b[d];_toggleHandles(b.length)}var _slider,_options={min:0,max:1440,step:30,gap:150,newlength:90,handleLabelDispFormat:function(a){var b=Math.floor(Math.abs(a)/60),c=Math.abs(a)%60;return(10>b&&b>=0?"0":"")+b+":"+(10>c&&c>=0?"0":"")+c},stepLabelDispFormat:function(a){var b=Math.floor(Math.abs(a)/60);return Math.abs(a)%60===0?(10>b&&b>=0?"0":"")+b:""}},_deletePeriodConfirm=null,_addPeriodConfirm=null,_onHandleMouseenter=null,_onHandleSlide=null,_onAddPeriod=null,_onDeletePeriod=null,SELECTORS={range:{"class":"ui-slider-range"},handle:{"class":"ui-slider-handle"},control:{"class":"ui-slider-control"}},_periods=[],_periodIdIncrementor=0,Period=function(a,b){function c(){if(a>=b)throw"Invalid arguments passed";d=++_periodIdIncrementor,e=[a,b]}var d,e,f,g=this;this.setIndexes=function(a){f=[a[0],a[1]]},this.getIndexes=function(){return[f[0],f[1]]},this.getId=function(){return d},this.setAbscissas=function(a){e=[a[0],a[1]]},this.getAbscissas=function(){return[e[0],e[1]]},this.toPublic=function(){return{getId:function(){return d},getAbscissas:function(){return g.getAbscissas()}}},c()},Utils={convertToPercent:function(a){return a/(_options.max-_options.min)*100}};this.addPeriods=function(a){"string"==typeof a&&(a=JSON.parse(a));for(var b=0;b<a.length;b++)_addPeriod(a[b][0],a[b][1]);return _rebuild(),this},this.getPeriods=function(){for(var a=[],b=0;b<_periods.length;b++)a.push(_periods[b].toPublic());return a},_init()}}(window,jQuery),$(function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(a){for(var b=0;b<this.length;b++)a.apply(this,[this[b],b,this])})});
